# Cryptography/椭圆曲线双线性配对(Pairing)

椭圆曲线中的双线性配对是一个非常复杂的议题. 我最早是从以太坊虚拟机的预编译合约中了解到这个概念: <https://eips.ethereum.org/EIPS/eip-197>. 随后工作要求将该算法移植到 RISC-V 上, 并且对它该算法的 cycles 消耗提出了非常严苛的要求, 真的是生活艰难!

## 双射和同构的概念

数学中, 一个由集合 X 映射至集合 Y 的函数, 若对每一在 Y 内的 y, 存在唯一一个在 X 内的 x 与其对应, 且对每一在 X 内的 x, 存在唯一一个在 Y 内的 y 与其对应, 则此函数为双射函数.

同构用于描述两个群之间的一种性质. 如果两个群之间存在一个函数满足双射的前提下, 同时满足 ϕ(a + b) = ϕ(a) + ϕ(b), 则称这两个群是同构的.

## 有限域

复习一下概念. 什么是有限域? 所谓有限域是指域集合元素个数为有限个的一个域.

最常用的有限域是素数域. 记为 Fp = {0, 1, ..., p − 1}, 其中 p 为素数, 0 和 1 分别为加法/乘法的单位元.

有限域中元素的个数称作有限域的阶. 可以证明, 所有的有限域的阶能写成 q = p<sup>n</sup> 的形式, 我们记作 Fq. 且有定理表明, 所有拥有相同的阶的有限群都是同构(isomorphic)的, 一般记作 F(p<sup>n</sup>).

F(p²) 的一个表现形式为 {a + bi|a ∈ Fp, b ∈ Fp}, 其中 i² = −1. 这种表示相当于对 Fp 做了一个域扩展 (Field Extension)Fp[x]/(x²+1).

## Pairing

椭圆曲线的 Pairing 表示为一个映射

```text
e: G1 × G2 → GT
```

G1, G2 定义在群 E(Fp<sup>k</sup>) 上(或其子群), 而 GT 定义在乘法群 Fp<sup>k</sup>上. 该映射满足如下性质

```text
e(P + P′, Q) = e(P, Q) · e(P′, Q)
e(P, Q + Q′) = e(P, Q) · e(P, Q′)
```

该性质的一个推论为

```
e(aP, bQ) = e(P, Q)^ab
```

Pairing 可用于破解 DDH 问题, 以及用于现代加密体系如 ZkSNARK. 简单来说, 基于 pairing 的加密体系能够通过密文验证两组明文的乘积是否相同, 但仍然不会暴露这个乘积.
